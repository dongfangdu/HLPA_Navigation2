import streamlit as st
import pandas as pd
import requests
import os.path as opt
from PIL import Image

IMAGE = opt.abspath(opt.join(__file__, opt.pardir, "case_query.png"))
SERVER_URL = "http://192.168.106.170:5005"
FORE_URL = "http://192.168.106.170:9995"

_default_samples = ["ä½ å¥½æˆ‘æƒ³æŸ¥ä¸‹æ¡ˆå­", "æˆ‘çš„èº«ä»½è¯æ˜¯330501197804é‚£ä¸ªä»€ä¹ˆ",
                    "æ˜¯330501197804160037", "å¤§æ¦‚æ˜¯å»å¹´çš„2æœˆ", "ä¸æ˜¯", "æ˜¯çš„",
                    "æˆ‘æƒ³æŸ¥ä¸‹æˆ‘çš„æ‰¿åŠæ³•å®˜æ˜¯è°", "æˆ‘é‚£ä¸ªæ¡ˆå­ç°åœ¨åˆ°å“ªä¸€æ­¥äº†",
                    "ä½ è¯´è¿™ä¸ªæ€ä¹ˆæ ·å“å˜¿è·Ÿä½ è¯´è¯å‘¢",
                    "ä½ ä»¬è¿™ä¸ªæœ‰äººå·¥æœåŠ¡å—"]

default_samples = []
while _default_samples:
    default_samples.append("")
    default_samples.append(_default_samples.pop(0))
default_samples.append("")

_default_answer = [
    "æ¬¢è¿ä½“éªŒæ™ºèƒ½è¯­éŸ³æœåŠ¡,æˆ‘ä»¬å¯ä»¥ä¸ºæ‚¨æä¾›æ¡ˆä»¶æŸ¥è¯¢å’Œå…¶ä»–æœåŠ¡ï¼Œè¯·é—®æ‚¨éœ€è¦ä»€ä¹ˆå¸®åŠ©",
    "è¯·å‘Šè¯‰æˆ‘æ‚¨çš„èº«ä»½è¯æ˜¯å¤šå°‘",
    "èº«ä»½è¯å·ç è¾“å…¥æœ‰è¯¯,è¯·é‡æ–°æŒ‰é”®è¾“å…¥",
    "æ‚¨å¥½,è¯·é‡æ–°å‘Šè¯‰æˆ‘æ‚¨å»æ³•é™¢æå‡ºè¯‰è®¼çš„å¤§æ¦‚æ—¥æœŸ",
    "æŸ¥è¯¢åˆ°å¤šä¸ªæ¡ˆå­,ç…§æœ€æ–°ç«‹æ¡ˆæ—¶é—´æ’­æŠ¥ç¡®è®¤,"
    "è¯·é—®æ¡ˆå·æ˜¯2019æµ™05æ‰§89å·,å½“äº‹äººæ˜¯è¢å»ºå,è¢«æ‰§è¡Œäººææ˜¥è¾‰,è‘£åˆå‡å—",
    "è¯·é—®æ¡ˆå·æ˜¯2020æµ™æ°‘ç»ˆ525å·,ä¸Šè¿°äººæ˜¯ææ˜¥è¾‰,è‘£åˆå‡,è¢«ä¸Šè¯‰äººæ˜¯è¢å»ºåå—",
    "è¯·é—®æ‚¨è¦æŸ¥è¯¢ä»€ä¹ˆä¿¡æ¯",
    "æ‚¨å¥½,è¯¥æ¡ˆä»¶çš„æ‰¿åŠæ³•å®˜æ˜¯è°¢èŠ³,å…·ä½“è¯¦æƒ…,æ‚¨å¯ç™»å½•ç§»åŠ¨å¾®æ³•é™¢æˆ–æµ™æ±Ÿæ³•é™¢ç½‘æŸ¥è¯¢,"
    "ç”³è¯·ä¸æ‚¨çš„æ‰¿åŠæ³•å®˜çº¿ä¸Šè¿›è¡Œæ²Ÿé€š,è¯·é—®è¿˜æœ‰ä»€ä¹ˆéœ€è¦å¸®æ‚¨",
    "æ‚¨å¥½è¯¥æ¡ˆä»¶çš„æ¡ˆä»¶çŠ¶æ€æ˜¯å·²å½’æ¡£ç»“æ¡ˆ,è¯·é—®è¿˜æœ‰ä»€ä¹ˆéœ€è¦å¸®æ‚¨",
    "æŠ±æ­‰æˆ‘æ²¡å¬æ¸…, æ‚¨éœ€è¦æŸ¥è¯¢ä»€ä¹ˆä¿¡æ¯å‘¢",
    "å¥½çš„æˆ‘å¸®æ‚¨è½¬äººå·¥å®¢æœ,æ‚¨ç¨ç­‰"]

default_answer = []
while _default_answer:
    default_answer.append(_default_answer.pop(0))
    default_answer.append("")
default_answer.pop(-1)

def case_query():
    st.title("12368å¸æ³•æœåŠ¡")

    # ===============
    # æ¦‚è¿°
    # ===============
    st.header("â™Ÿ æ¦‚è¿° â™Ÿ")
    st.markdown("**12368å¸æ³•æœåŠ¡çƒ­çº¿**ï¼Œæ˜¯ä¾¿äºç”¨æˆ·æ ¹æ®è‡ªå·±çš„æ¡ˆå­è¿›è¡Œç›¸å…³æ¡ˆä»¶ä¿¡æ¯ã€è¿›åº¦æŸ¥è¯¢çš„äº§å“\n")
    st.markdown("ç›®å‰å·²åº”ç”¨äºæ¹–å·ã€æ­å·ä¸‹åŸåŒºç­‰\n")

    # ===============
    # æµç¨‹å›¾
    # ===============
    st.header("â™Ÿ æµç¨‹å›¾ â™Ÿ")
    if st.checkbox("ğŸ„ ç‚¹å‡»æŸ¥çœ‹æµç¨‹å›¾"):
        image_1 = Image.open(IMAGE)
        st.image(image_1, caption="æ¡ˆä»¶æŸ¥è¯¢æµç¨‹å›¾", use_column_width = True)

    # ===============
    # æ ·ä¾‹ä½“éªŒ
    # ===============
    st.header("â™Ÿ æ ·ä¾‹ä½“éªŒ â™Ÿ")
    if st.checkbox("ğŸ„ ç‚¹å‡»æŸ¥çœ‹æ ·ä¾‹å¯¹è¯"):
        chat1 = dict(User = default_samples, Bot = default_answer)
        st.table(chat1)

    # ===============
    # äº¤äº’ä½“éªŒ
    # ===============
    st.header("â™Ÿ äº¤äº’ä½“éªŒ â™Ÿ")
    st.warning("ä½“éªŒç¯å¢ƒä¸ºæµ‹è¯•ç¯å¢ƒï¼Œè§£æå¯èƒ½å­˜åœ¨å»¶è¿Ÿ")
    st.warning("æ¶‰åŠèº«ä»½è¯ä¸æ—¥æœŸè¯·è¾“å…¥æµ‹è¯•æ¡ˆä¾‹ä¿¡æ¯")

    try:
        requests.get(url = FORE_URL)
    except:
        st.error("æœåŠ¡æœªå¼€å¯ï¼Œè¯·è”ç³»ASRåŸºç¡€ç ”å‘éƒ¨")

    href_url = FORE_URL
    st.markdown(f"[ç‚¹å‡»è·³è½¬è‡³ **äº¤äº’é¡µé¢**]({href_url})")

    # ===============
    # API æ¥å£æ–‡æ¡£
    # ===============
    st.header("â™Ÿ API æ¥å£æ–‡æ¡£ â™Ÿ")
    if st.checkbox("ç‚¹å‡»æŸ¥çœ‹ æ¥å£æ–‡æ¡£"):
        st.write("æœåŠ¡é€šè¿‡ HTTP/POST è¿›è¡ŒæœåŠ¡è§£æè¯·æ±‚\n")

        option = st.selectbox("å…¥å‚/å‡ºå‚", ("å…¥å‚ JSON", "å‡ºå‚ JSON"))
        if option == "å…¥å‚ JSON":
            st.markdown("**è®¿é—®åœ°å€**")
            st.write("åœ¨è®¿é—®åœ°å€ä¸Šï¼Œä½¿ç”¨ä¸åŒçš„ session_id è¿›è¡Œæ¯ä¸ªç”¨æˆ·çš„å¯¹è¯æµç¨‹ç®¡ç†")
            st.markdown("```" + "http//$ip:$port/conversations/$session_id/respond""```")

            st.json({"q": "æˆ‘æƒ³æŸ¥ä¸‹æˆ‘ä¸€ä¸ªæ¡ˆå­"})

            st.write('\n')
            st.table(pd.DataFrame({
                "å±æ€§": ["sentence"],
                "ç±»å‹": ["String"],
                "è¯´æ˜": ["ç”¨æˆ·æ–‡æœ¬"]
            }))

        elif option == "å‡ºå‚ JSON":

            st.json({"text": "è¯·å‘Šè¯‰æˆ‘æ‚¨çš„èº«ä»½è¯",
                     "recipient_id": "123",
                     "customMessage": {}
                     })

            st.write('\n')
            st.table(pd.DataFrame({
                "å±æ€§": ["text", "recipient_id", "customMessage"],
                "ç±»å‹": ["String", "String", "Any"],
                "è¯´æ˜": ["æœºå™¨å›è¯", "ç”¨æˆ·session_id", "è‡ªå®šä¹‰ä¼ å‡ºä¿¡æ¯"]
            }))

    # ===============
    # å®šåˆ¶éœ€æ±‚
    # ===============
    st.header("â™Ÿ å®šåˆ¶éœ€æ±‚ â™Ÿ")
    if st.checkbox("ç‚¹å‡»æŸ¥çœ‹ å®šåˆ¶éœ€æ±‚"):
        st.write("è¯¥èƒ½åŠ›æŒç»­ä¼˜åŒ–ä¸­\n")
        st.write("åŒæ—¶ä¹Ÿæ”¯æŒåœºæ™¯å®šåˆ¶åŒ–")

if __name__ == "__main__":
    case_query()