<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>robotChat</title>
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link rel="stylesheet" href="css/home.css">
	<script src="js/jquery-3.0.0.min.js"></script>
	<script src="js/axios.min.js"></script>
</head>

<body>
	<div class="chat-wrapper">
		<div class="chat-main">
			<div class="chat-header">
				<div class="chat-service-info">
					<div class="chat-service-img">
						<img src="images/header.jpg" alt="" width="100%">
					</div>
					<div class="chat-service-title">
						<p class="chat-service-name">客服1</p>
						<p class="chat-service-detail">我是您的专属客服</p>
					</div>
				</div>
			</div>
			<div id="chat_contain" class="chat-contain"></div>
			<div class="chat-submit">
				<p id='chatHint' class="chat-hint"><span class="chat-hint-icon">!</span><span
						class="chat-hint-text">发送内容不能为空</span></p>
				<textarea id="chat_input" class="chat-input-text" autofocus
					placeholder="请输入您想对我说的话，按Enter键发送（shift+Enter换行）。"></textarea>
				<div class="chat-input-tools">
					<button class="chat-input-button" onclick="onSendMsg()">发送</button>&nbsp;
					<button class="chat-service-simulator" onclick="onReset()">重置</button>
				</div>
			</div>
		</div>
	</div>
	<!-- 表格 -->
	<!-- <div class="right">
		<p class="card_id">身份证号  520520520520520520</p>
		<table class="table" border="1px">
			<thead>                                                  
				<th style="width: 100px;">案件号</th>
				<th>收案日期</th>
				<th>立案日期</th>
				<th>开庭日期</th>
				<th>结案日期</th>
				<th>书记员</th>
				<th>承办法官</th>
				<th>承办部门</th>
				<th>开庭法庭</th>
				<th>处罚金</th>
				<th>当事人</th>
			</thead>
			<tbody>
				<tr>       
					<td>2019浙1234民事0001号</td>
					<td>2020-01</td>
					<td>2020-01</td>
					<td>2020-01</td>
					<td>2020-01</td>
					<td>防火女</td>
					<td>防火女</td>
					<td>传火祭祀场</td>
					<td>传火祭祀场</td>
					<td>520</td>
					<td>yyh</td>
				</tr>
				<tr>
					<td>2019浙1234民事0002号</td>
					<td>2020-02</td>
					<td>2020-02</td>
					<td>2020-02</td>
					<td>2020-02</td>
					<td>洋葱骑士</td>
					<td>洋葱骑士</td>
					<td>赛恩古城</td>
					<td>赛恩古城</td>
					<td>0</td>
					<td>yyh</td>
				</tr>
				<tr>
					<td>2019浙1234民事0003号</td>
					<td>2020-03</td>
					<td>2020-03</td>
					<td>2020-03</td>
					<td>2020-03</td>
					<td>奥斯卡</td>
					<td>奥斯卡</td>
					<td>北方不死院</td>
					<td>北方不死院</td>
					<td>0</td>
					<td>yyh</td>
				</tr>
				<tr>
					<td>2019浙1234民事0004号</td>
					<td>2020-04</td>
					<td>2020-04</td>
					<td>2020-04</td>
					<td>2020-04</td>
					<td>王城双基</td>
					<td>王城双基</td>
					<td>亚诺尔隆德</td>
					<td>亚诺尔隆德</td>
					<td>1000</td>
					<td>yyh</td>
				</tr>
			</tbody>
		</table>
	</div> -->

	<script>
		//参数
		let list = {
			"q": '',
		}
		//获取当前时间
		let getNowTime = () => {
			let date = new Date();
			return `${date.getHours()}:${date.getMinutes() < 10 ? '0' + date.getMinutes() : date.getMinutes()}:${date.getSeconds() < 10 ? '0' + date.getSeconds() : date.getSeconds()}`;
		}
		//左侧
		let leftTem = content => {
			return (`<div class="row">
				<div class="chat_left">
					<div class="chat_timel">${getNowTime()}</div>
					${content}
				</div>
			</div>`)
		}
		//右侧
		let rightTem = content => {
			return (`<div class="row">
				<div class="chat_right">
					<div class="chat_timer">${getNowTime()}&nbsp;&nbsp;&nbsp;<span class="name">${list.session_id}</span></div>
					${content}
				</div>
			</div>`)
		}
		//默认值
		$('#chat_contain').append(leftTem('欢迎致电湖州12368服务热线，您可以进行案件查询、法院信息查询、法律咨询、信访投诉与建议，有什么可以帮您？'));
		var session_id=new Date().getTime();

		//发送消息
		let onSendMsg = () => {
			if (!$('#chat_input').val().toString().trim()) {
				return;
			}
			$('#chat_contain').append(rightTem($('#chat_input').val()));

			list.q= $('#chat_input').val();

			// axios创建请求
			axios.post(`http://192.168.100.210:5005/conversations/${session_id}/respond`, list,
					{headers:{'Access-Control-Allow-Origin': "*"}}).then(({data}) => {

				$('#chat_contain').append(leftTem(data.text));  //机器人对话 brain_result
				$('#chat_input').val('');
				// list.if_menu = data.if_menu;

				var scrollHeight = $('#chat_contain').prop("scrollHeight");
				$('#chat_contain').scrollTop(scrollHeight, 200);
			}).catch(err => {
				console.log(err);
			});
		};
		//重置
		let onReset = () => {
			$('#chat_contain').empty();
			$('#chat_contain').append(leftTem('欢迎致电湖州12368服务热线，您可以进行案件查询、法院信息查询、法律咨询、信访投诉与建议，有什么可以帮您？'));
			
			let id = '';
			for(let i=0; i<3; i++){
				let str = String.fromCharCode(Math.floor(Math.random() * 26) + "a".charCodeAt(0));
				id += str;
			}
			// list.session_id = id;
			// list.if_menu = '1';
		};
		//键盘操作
		$(document).keydown(function (e) {
			let keyCode = e.keyCode;
			// 判断组合键，不是【shift + Enter】就改写【Enter】的默认功能
			if (!e.shiftKey && e.keyCode == 13) {
				e.cancelBubble = true;
				e.preventDefault();
				e.stopPropagation();
				onSendMsg();
			}
		})
	</script>
</body>
</html>

<!--{"tts_yg": "袁哥", "tts_bg": "张三", "tts_ay": "调戏良家妇女"}-->